metricbeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: false

metricbeat.modules:
  - module: elasticsearch
    xpack.enabled: true
    period: 10s
    hosts: ${ELASTIC_HOSTS}
    ssl.certificate_authorities: "certs/ca/ca.crt"
    ssl.certificate: "certs/es01/es01.crt"
    ssl.key: "certs/es01/es01.key"
    username: ${ELASTIC_USER}
    password: ${ELASTIC_PASSWORD}
    ssl.enabled: true

  - module: system
    metricsets:
      - cpu
      - load
      - memory
      - network
      - uptime
    enabled: true
    period: 10s
    processes: ['.*']

  - module: system
    metricsets:
      - filesystem
      - fsstat
    period: 10s
    filesystem.ignore_types: [smbfs, proc, autofs, securityfs, squashfs, tmpfs, devtmpfs, cifs, iso9660, udf]

  - module: kibana
    metricsets: 
      - stats
    period: 10s
    hosts: http://kibana:5601
    username: ${ELASTIC_USER}
    password: ${ELASTIC_PASSWORD}
    ssl.certificate_authorities: "certs/ca/ca.crt"
    ssl.certificate: "certs/es01/es01.crt"
    ssl.key: "certs/es01/es01.key"
    xpack.enabled: true

  - module: docker
    metricsets:
      - "container"
      - "cpu"
      - "diskio"
      - "healthcheck"
      - "info"
      - "memory"
      - "network"
    hosts: ["unix:///var/run/docker.sock"]
    period: 10s
    enabled: true

setup.dashboards:
  enabled: true
setup.kibana:
  host: http://kibana:5601
  username: ${ELASTIC_USER}
  password: ${ELASTIC_PASSWORD}

processors:
 - add_host_metadata: ~
 - add_docker_metadata: ~

output.elasticsearch:
  hosts: ${ELASTIC_HOSTS}
  username: ${ELASTIC_USER}
  password: ${ELASTIC_PASSWORD}
  allow_older_versions: true
  name: "asgard-agent"
  indices:
    - index: "metricbeat-asgard-%{[agent.version]}-%{+yyyy.MM.dd}"
  ssl:
    certificate: "certs/es01/es01.crt"
    certificate_authorities: "certs/ca/ca.crt"
    key: "certs/es01/es01.key"